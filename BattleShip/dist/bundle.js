(()=>{"use strict";const t=class{constructor(t,e=null){if("number"!=typeof t||t<=0)throw new Error("Ship length must be a positive number");this.length=t,this.type=e||this.constructor.name,this.hits=new Set,this.positions=[]}hit(t){return t>=0&&t<this.length&&(this.hits.add(t),!0)}isSunk(){return this.hits.size>=this.length}isPositionHit(t){return this.hits.has(t)}},e=class{constructor(){this.boardSize=10,this.ships=[],this.missedAttacks=new Set,this.hitAttacks=new Set}placeShip(e,s,a,i=!1){if(!this.areValidCoordinate(e,s)||"number"!=typeof a||a<=0)return!1;const r=[];for(let t=0;t<a;t++){const a=i?e:e+t,n=i?s+t:s;if(!this.areValidCoordinate(a,n))return!1;if(this.getShipAt(a,n))return!1;r.push({x:a,y:n})}const n=new t(a);return n.positions=r,this.ships.push(n),!0}recieveAttack(t,e){if(!this.areValidCoordinate(t,e))return!1;if(this.allAttacks.has(`${t},${e}`))return!1;const s=this.getShipAt(t,e);return s?(s.hit(),this.hitAttacks.add(attackKey),!0):(this.missedAttacks.add(attackKey),!1)}allShipSink(){return this.ships.length>0&&this.ships.every(t=>t.isSunk())}areValidCoordinate(t,e){return Number.isInteger(t)&&Number.isInteger(e)&&t>=0&&t<this.boardSize&&e>=0&&e<this.boardSize}getShipAt(t,e){return this.ships.find(s=>s.positions.some(s=>s.x===t&&s.y===e))}},s=class{constructor(t="human",s="Player"){if(!["human","computer"].includes(t))throw new Error("Player type must be either 'human' or 'computer'");this.type=t,this.name=s,this.gameBoard=new e,this.previousAttacks=new Set}attack(t,e,s){return"human"===this.type?this.humanAttack(e,s,t):this.computerAttack(t)}placeShipsRandomly(t=[5,4,3,2]){"computer"===this.type&&t.forEach(t=>{let e=!1;for(;!e;){const s=Math.floor(10*Math.random()),a=Math.floor(10*Math.random()),i=Math.random()>.5;e=this.gameBoard.placeShip(s,a,t,i)}})}humanAttack(t,e,s){if("number"!=typeof t||"number"!=typeof e)return!1;const a=`${t},${e}`;return!this.previousAttacks.has(a)&&(this.previousAttacks.add(a),s.gameBoard.recieveAttack(t,e))}computerAttack(t){const e=this.findAdjacentTarget();return e?this.executeAttack(t,e.x,e.y):this.randomAttack(t)}};function a(t,e,s,a){const i=document.querySelector(`#${t}-board [data-x="${e}"][data-y="${s}"]`);if(i&&(i.classList.add(a?"hit":"miss"),i.style.pointerEvents="none",a&&"computer"===t)){const t=computer.gameBoard.getShipAt(e,s);t?.isSunk()&&t.positions.forEach(t=>{const e=document.querySelector(`#computer-board [data-x="${t.x}"][data-y="${t.y}"]`);e?.classList.add("sunk")})}}function i(t){document.getElementById("game-message").textContent=t}const r=new s("human","Player 1"),n=new s("computer","Computer");function o(){if(!1!==n.attack(r)){const[t,e]=n.previousAttacks.values().next().value.split(",").map(Number);a("player",t,e,n.previousAttacks.has(`${t},${e}`)),r.gameBoard.allShipSink()?i("Game over! Computer won!"):i("Your turn!")}}window.handlePlayerAttack=function(t,e){if(r.attack(n,t,e)){if(a("computer",t,e,r.previousAttacks.has(`${t},${e}`)),n.gameBoard.allShipSink())return void i("Congratulations! You won!");setTimeout(o,1e3)}},document.addEventListener("DOMContentLoaded",function(){r.gameBoard.placeShip(0,0,5,!1),r.gameBoard.placeShip(2,2,4,!0),r.gameBoard.placeShip(5,5,3,!1),r.gameBoard.placeShip(8,1,2,!0),n.placeShipsRandomly([5,4,3,2]),function(t,e){const s=document.getElementById("player-board"),a=document.getElementById("computer-board");s.innerHTML="",a.innerHTML="";for(let i=0;i<10;i++)for(let r=0;r<10;r++){const n=document.createElement("div");n.className="cell",n.dataset.x=r,n.dataset.y=i;const o=t.gameBoard.getShipAt(r,i);o&&n.classList.add("ship"),e.previousAttacks.has(`${r},${i}`)&&n.classList.add(o?"hit":"miss"),s.appendChild(n);const c=document.createElement("div");if(c.className="cell",c.dataset.x=r,c.dataset.y=i,t.previousAttacks.has(`${r},${i}`)){const t=e.gameBoard.getShipAt(r,i);c.classList.add(t?"hit":"miss")}else c.addEventListener("click",()=>{handlePlayerAttack(r,i)});a.appendChild(c)}}(r,n),i("Game started! Your turn.")})})();